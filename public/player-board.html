<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Player Dashboard ‚Äî Udderly the Same</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body {
      font-family:'Segoe UI',Arial,sans-serif;
      max-width:900px;
      margin:30px auto;
      background:linear-gradient(135deg,#fdfcfb,#e2d1c3);
      padding:20px;
      border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }
    .header { display:flex; align-items:center; gap:12px; margin-bottom:20px;}
    .logo { max-width:100px; height:auto; display:block;}
    h2 { margin:0;}
    #statusMessage { font-weight:bold; margin-top:10px; text-align:center; color:#444;}
    button {
      padding:10px 18px; margin:6px; font-size:16px; border:none; border-radius:8px;
      cursor:pointer; background:#333; color:#fff; transition:background 0.3s ease;
    }
    button:hover:enabled { background:#F7AC4D;}
    button:disabled { background:#999; cursor:not-allowed;}
    .accordion { margin-top:20px; border-radius:8px; overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
    .accordion-header { background:#333; color:#fff; padding:12px; cursor:pointer; font-weight:bold;}
    .accordion-header:hover { background:#F7AC4D;}
    .accordion-content { max-height:0; overflow:hidden; transition:max-height 0.4s ease; background:#fff; padding:0 15px;}
    .accordion-content.open { padding:15px; max-height:1000px;}
    #answersTable, #playersTable, #scoreTable {
      font-size:18px; border-collapse:collapse; width:100%; margin-top:10px;
    }
    #answersTable th,#answersTable td, #playersTable th,#playersTable td, #scoreTable th,#scoreTable td {
      border-bottom:1px solid #ccc; padding:8px; text-align:left;
    }
    #playersTable th:nth-child(2), #playersTable td:nth-child(2) {
      width: 60px;
      text-align: center;
    }
    textarea {
      width:100%; max-width:800px; padding:10px; border-radius:6px;
      border:1px solid #ccc; margin-bottom:10px; font-size:16px;
    }

    /* Control Switches styling */
    #controlsBox {
      display: flex;
      flex-direction: column;   /* stack switches vertically */
      align-items: flex-start;  /* align labels to the left */
    }
    .switch {
      display: block;           /* each switch on its own line */
      margin: 10px 0;           /* spacing between switches */
    }
    .switch label {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }
    .switch input { display: none; }
    .slider {
      position: relative;
      width: 40px;
      height: 20px;
      background-color: #ccc;
      border-radius: 20px;
      transition: background-color 0.3s;
    }
    .slider::before {
      content: "";
      position: absolute;
      width: 16px;
      height: 16px;
      left: 2px;
      top: 2px;
      background-color: white;
      border-radius: 50%;
      transition: transform 0.3s;
    }
    .switch input:checked + .slider { background-color: #4CAF50; }
    .switch input:checked + .slider::before { transform: translateX(20px); }

    /* Top status styling */
    #topStatus { font-weight:bold; color:#444; margin-left:auto; }
    .roomHeader { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    .small { font-size: 12px; color: #666; }

    /* Scoreboard column width */
    #scoreTable th.roundCol, #scoreTable td.roundCol {
      width: 40px; /* enough for 2 digits */
      text-align: center;
    }
    select.scoreSelect {
      width: 100%;
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="udder-consensus-logo.png" alt="Udderly the Same Logo" class="logo">
    <h2>
      üêÆ Player Dashboard 
      <span class="small">(v 1.1.2)</span>
    </h2>
  </div>

  <!-- Room Info Accordion -->
  <div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion('questionBox')">Game Room Info</div>
    <div id="questionBox" class="accordion-content open">
      <div class="roomHeader">
        <p id="roomLabel"></p>
        <span id="topStatus"></span>
      </div>

      <table id="playersTable">
        <thead><tr><th>Player</th><th>Out</th><th>Status</th></tr></thead>
        <tbody></tbody>
      </table>

      <div id="controls">
        <button id="startBtn">Start Round</button>
        <button id="showAnswersBtn" disabled>Show Answers</button>
        <p id="statusMessage"></p>
      </div>

      <div id="qaSection" style="display:none;">
        <p id="questionPrompt"></p>
        <textarea id="answerInput" rows="2" placeholder="Type your answer..."></textarea>
        <button id="submitAnswerBtn">Submit Answer</button>
        <p id="progress"></p>
      </div>
    </div>
  </div>

  <!-- Control Switches Accordion -->
  <div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion('controlsBox')">Control switches</div>
    <div id="controlsBox" class="accordion-content">
      <div class="switch">
        <label>
          <input type="checkbox" id="toggleStart" checked>
          <span class="slider"></span>
          Enable Start Round
        </label>
      </div>
      <div class="switch">
        <label>
          <input type="checkbox" id="toggleShow" checked>
          <span class="slider"></span>
          Enable Show Answers
        </label>
      </div>
      <div class="switch">
        <label>
          <input type="checkbox" id="toggleSubmit" checked>
          <span class="slider"></span>
          Enable Submit Answer
        </label>
      </div>
    </div>
  </div>

  <!-- Answers Accordion -->
  <div id="answersAccordion" class="accordion" style="display:none;">
    <div class="accordion-header" onclick="toggleAccordion('answersTableWrapper')">Answers</div>
    <div id="answersTableWrapper" class="accordion-content">
      <table id="answersTable">
        <thead><tr><th>Point</th><th>Name</th><th>Answer</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Scoreboard Accordion -->
  <div class="accordion">
    <div class="accordion-header" onclick="toggleAccordion('scoreboardBox')">Scoreboard</div>
    <div id="scoreboardBox" class="accordion-content">
      <button id="updateScoresBtn">Update Scores</button>
      <table id="scoreTable">
        <thead><tr><th>Player</th><th>Total</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // ... existing JS logic ...
    // Only showing the renderScoreboard function update for brevity:

    function renderScoreboard(data) {
      const allRounds = data.flatMap(d => Object.keys(d.rounds || {}).map(n => parseInt(n, 10)));
      const maxRound = Math.max(0, ...allRounds);

      const header = "<tr><th>Player</th><th>Total</th>" +
        Array.from({length: maxRound}, (_, i) => `<th class="roundCol">#${i+1}</th>`).join("") +
        "</tr>";
      document.querySelector("#scoreTable thead").innerHTML = header;

      const rows = data.map(d => {
        const total = d.total || 0;
        const roundCells = Array.from({length: maxRound}, (_, i) => {
          const rnum = i + 1;
          const val = (d.rounds && d.rounds[rnum]) != null ? d.rounds[rnum] : 0;
          return `<td class="roundCol">
                    <select class="scoreSelect" data-player="${escapeHTML(d.player_name)}" data-round="${rnum}">
                      <option value="0" ${val==0?"selected":""}>0</option>
                      <option value="1" ${val==1?"selected":""}>1</option>
                    </select>
                  </td>`;
        }).join("");
        return `<tr><td>${escapeHTML(d.player_name)}</td><td>${total}</td>${roundCells}</tr>`;
      }).join("");

      document.querySelector("#scoreTable tbody").innerHTML = rows;
    }

    function toRoundMap(data, round) {
      const map = {};
      (data || []).forEach(d => {
        const val = (d.rounds && d.rounds[round]) != null ? d.rounds[round] : 0;
        map[escapeHTML(d.player_name)] = parseInt(val, 10) === 1 ? 1 : 0;
      });
      return map;
    }

    // Existing helpers
    function escapeHTML(str){
      const div=document.createElement('div');
      div.innerText=String(str||"");
      return div.innerHTML;
    }
    function toggleAccordion(id){document.getElementById(id).classList.toggle("open");}
    function openAccordion(id){document.getElementById(id).classList.add("open");}
    function closeAccordion(id){document.getElementById(id).classList.remove("open");}

    // Update Scores button now reads dropdowns
    document.getElementById("updateScoresBtn").onclick = () => {
      document.querySelectorAll(".scoreSelect").forEach(select => {
        const player = select.dataset.player;
        const round = parseInt(select.dataset.round, 10);
        const points = parseInt(select.value, 10);
        socket.emit("awardPoint", { roomCode, playerName: player, roundNumber: round, points });
      });
    };
  </script>
</body>
</html>
