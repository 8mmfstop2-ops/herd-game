<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Player Dashboard ‚Äî Udderly the Same</title>
  <script src="/socket.io/socket.io.js"></script>

  <style>
    /* --- Base layout --- */
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      max-width: 900px;
      margin: 30px auto;
      background: linear-gradient(135deg, #fdfcfb, #e2d1c3);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h2 { margin: 0; }
    .small { font-size: 12px; color: #666; }

    /* --- Header --- */
    .header { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
    .logo { max-width: 100px; height: auto; display: block; }
    #statusMessage { font-weight: bold; margin-top: 10px; text-align: center; color: #444; }

    /* --- Buttons --- */
    button {
      padding: 10px 18px; margin: 6px; font-size: 16px;
      border: none; border-radius: 8px; cursor: pointer;
      background: #333; color: #fff; transition: background 0.3s ease;
    }
    button:hover:enabled { background: #F7AC4D; }
    button:disabled { background: #999; cursor: not-allowed; }

    /* --- Accordion --- */
    .accordion { margin-top: 20px; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .accordion-header { background: #333; color: #fff; padding: 12px; cursor: pointer; font-weight: bold; }
    .accordion-header:hover { background: #F7AC4D; }
    .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease; background: #fff; padding: 0 15px; }
    .accordion-content.open { padding: 15px; max-height: 1000px; }

    /* --- Tables --- */
    #answersTable, #playersTable, #scoreTable {
      font-size: 18px; border-collapse: collapse; width: 100%; margin-top: 10px;
    }
    #answersTable th, #answersTable td,
    #playersTable th, #playersTable td,
    #scoreTable th, #scoreTable td { border-bottom: 1px solid #ccc; padding: 8px; }

    /* --- Scoreboard specifics --- */
    #scoreTable th, #scoreTable td { padding: 6px; }
    #scoreTable th:first-child, #scoreTable td:first-child { text-align: left; padding-left: 10px; }
    #scoreTable th:nth-child(2), #scoreTable td:nth-child(2) { text-align: center; width: 60px; }
    #scoreTable th:nth-child(n+3), #scoreTable td.roundCell { text-align: center; width: 35px; }
    .scoreSelect { width: 100%; text-align: center; }

    /* --- Labels --- */
    .pointLabel { margin-left: 8px; font-weight: bold; }
    .pointLabel.green { color: #2e7d32; }
    .pointLabel.blue  { color: #0d47a1; text-shadow: 0 0 2px #fff; }

    /* --- Textarea --- */
    textarea {
      width: 100%; max-width: 800px; padding: 10px;
      border-radius: 6px; border: 1px solid #ccc;
      margin-bottom: 10px; font-size: 16px;
    }

    /* --- Switches --- */
    .switch { display: block; margin-bottom: 12px; }
    .switch label { display: flex; align-items: center; gap: 10px; cursor: pointer; }
    .switch input { display: none; }
    .slider {
      position: relative; width: 60px; height: 28px;
      background-color: #ccc; border-radius: 28px; transition: background-color 0.3s;
    }
    .slider::before {
      content: ""; position: absolute; width: 24px; height: 24px;
      left: 2px; top: 2px; background-color: white;
      border-radius: 50%; transition: transform 0.3s;
    }
    .switch input:checked + .slider { background-color: #2e7d32; }
    .switch input:checked + .slider::before { transform: translateX(32px); }

    /* --- Game Over Banner --- */
    #gameOverBanner {
      background-color: #d32f2f; color: white; font-weight: bold;
      text-align: center; padding: 25px; font-size: 22px;
      margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .hidden { display: none; }
  </style>
</head>
<body>

<!-- --- Header --- -->
<div class="header">
  <img src="udder-consensus-logo.png" alt="Udderly the Same Logo" class="logo">
  <h2>üêÆ Player Dashboard <span class="small">(v 1.1.3)</span></h2>
  <button id="endGameBtn" style="margin-left:auto;">End Game</button>
</div>

<!-- --- Banner --- -->
<div id="gameOverBanner" class="hidden">üéÆ Game Over</div>

<!-- --- Game Room Info Accordion --- -->
<div class="accordion">
  <div class="accordion-header" onclick="toggleAccordion('questionBox')">Game Room Info</div>
  <div id="questionBox" class="accordion-content open">
    <div class="roomHeader">
      <p id="roomLabel"></p>
      <span id="topStatus"></span>
    </div>
    <table id="playersTable">
      <thead><tr><th>Player</th><th>Out</th><th>Status</th></tr></thead>
      <tbody></tbody>
    </table>
    <div id="controls">
      <button id="startBtn">Start Round</button>
      <button id="showQuestionBtn" disabled>Show Question</button>
      <button id="showAnswersBtn" disabled>Show Answers</button>
      <p id="statusMessage"></p>
    </div>
    <div id="qaSection" style="display:none;">
      <p id="questionPrompt"></p>
      <textarea id="answerInput" rows="2" placeholder="Type your answer..."></textarea>
      <button id="submitAnswerBtn">Submit Answer</button>
      <p id="progress"></p>
    </div>
  </div>
</div>

<!-- --- Control Switches Accordion --- -->
<div class="accordion">
  <div class="accordion-header" onclick="toggleAccordion('controlsBox')">Control switches</div>
  <div id="controlsBox" class="accordion-content">
    <div class="controlsLayout">
      <div class="leftColumn">
        <div class="switch">
          <label><input type="checkbox" id="toggleStart" checked><span class="slider"></span>Enable Start Round</label>
        </div>
        <div class="switch">
          <label><input type="checkbox" id="toggleShow" checked><span class="slider"></span>Enable Show Answers</label>
        </div>
        <div class="switch">
          <label><input type="checkbox" id="toggleSubmit" checked><span class="slider"></span>Enable Submit Answer</label>
        </div>
      </div>
      <div class="rightColumn">
        <button id="signOutBtn">Sign Out</button>
      </div>
    </div>
  </div>
</div>

<!-- --- Answers Accordion --- -->
<div id="answersAccordion" class="accordion" style="display:none;">
  <div class="accordion-header" onclick="toggleAccordion('answersTableWrapper')">Answers</div>
  <div id="answersTableWrapper" class="accordion-content">
    <table id="answersTable">
      <thead><tr><th>Point</th><th>Name</th><th>Answer</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- --- Scoreboard Accordion --- -->
<div class="accordion">
  <div class="accordion-header" onclick="toggleAccordion('scoreboardBox')">Scoreboard</div>
  <div id="scoreboardBox" class="accordion-content">
    <table id="scoreTable">
      <thead><tr><th>Player</th><th>Total</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- --- Popup Modal --- -->
<div id="roundPopup" class="popup">
  <div class="popup-content">
    <span id="closePopup" class="close-btn">&times;</span>
    <h1 id="popupQuestion"></h1>
  </div>
</div>

<!-- --- Script --- -->
<script>
  /* --- Setup --- */
  const urlParams = new URLSearchParams(window.location.search);
  const roomCode = (urlParams.get("room") || "").toUpperCase();
  const myName = urlParams.get("name") || "";
  document.getElementById("roomLabel").innerText = `Room: ${roomCode} ‚Äî You: ${myName}`;
  const socket = io();
  socket.emit("joinLobby", { roomCode, name: myName });

  /* --- DOM Elements --- */
  const startBtn = document.getElementById("startBtn");
  const showBtn = document.getElementById("showAnswersBtn");
  const showQuestionBtn = document.getElementById("showQuestionBtn");
  const statusMsg = document.getElementById("statusMessage");
  const submitBtn = document.getElementById("submitAnswerBtn");
  const inputBox = document.getElementById("answerInput");
  const endGameBtn = document.getElementById("endGameBtn");
  const signOutBtn = document.getElementById("signOutBtn");

  /* --- State --- */
  let roomIsClosed = false;
  let allPlayers = new Set();
  let answersShown = false;
  let currentRound = 0;
  let scoreboard = [];
  let pendingQuestion = null;

  /* --- Controls --- */
  endGameBtn.onclick = () => {
    if (confirm("Are you sure you want to end this game?")) {
      socket.emit("closeRoom", { roomCode });
    }
  };
  signOutBtn.onclick = () => { window.location.href = "index.html"; };
  startBtn.onclick = () => { socket.emit("startRound", { roomCode }); showQuestion(); };
  showQuestionBtn.onclick = () => { showQuestion(); };
  showBtn.onclick = () => { socket.emit("showAnswers", { roomCode }); answersShown = true; };

  /* --- Switch Overrides --- */
  document.getElementById("toggleStart").onchange = e => { startBtn.disabled = roomIsClosed ? true : !e.target.checked; };
  document.getElementById("toggleShow").onchange = e => { showBtn.disabled = !e.target.checked; };
  document.getElementById("toggleSubmit").onchange = e => {
    const on = e.target.checked; submitBtn.disabled = !on; inputBox.disabled = !on;
  };

  /* --- Server Events --- */
  socket.on("roomClosed", () => {
    roomIsClosed = true;
    statusMsg.innerText = "This game room has been closed.";
    startBtn.disabled = showBtn.disabled = showQuestionBtn.disabled = submitBtn.disabled = inputBox.disabled = endGameBtn.disabled = true;
    document.getElementById("gameOverBanner").classList.remove("hidden");
  });

  socket.on("roundClosed", () => {
    document.getElementById("qaSection").style.display = "none";
    statusMsg.innerText = "Round finished. Waiting for next round‚Ä¶";
    submitBtn.disabled = true;
    inputBox.disabled = true;
    document.getElementById("toggleSubmit").checked = false;
    startBtn.disabled = false;
    document.getElementById("toggleStart").checked = true;
    showBtn.disabled = true;
    document.getElementById("toggleShow").checked = false;
  });

  /* --- Helpers --- */
  function toggleAccordion(id){ document.getElementById(id).classList.toggle("open"); }
  function openAccordion(id){ document.getElementById(id).classList.add("open"); }
  function closeAccordion(id){ document.getElementById(id).classList.remove("open"); }
</script>
</body>
</html>

